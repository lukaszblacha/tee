if(!("push"in Array)){Array.push=function(){var a=this.length>>>0;for(var b=0;b<arguments.length;b++){this[a]=arguments[b];a=a+1>>>0}this.length=a;return a}}if(!("pop"in Array)){Array.pop=function(){var a=this.length>>>0,b;if(a){b=this[--a];delete this[a]}this.length=a;return b}}if(typeof TouchList=="undefined"){function TouchList(){var a=new Array;a.item=function(a){return this[a]};a.identifiedTouch=function(a){console.log("Warning: Using W3C-only methid TouchList.identifiedTouch");for(var b=0;b<this.length;b++){if(this[b].identifier==a)return this[b]}return null};return a}}if(typeof Touch=="undefined")function Touch(a,b,c,d){this.identifier=a;this.target=b;this.clientX=c;this.pageX=c;this.screenX=c;this.pageY=d;this.clientY=d;this.screenY=d}var touchFacade=new function(){this.emulator=null;this.touchCountMap=[];for(var a=0;a<20;a++){this.touchCountMap.push([])}this.init=function(){document.addEventListener("touchstart",touchFacade.handler,false);document.addEventListener("touchmove",touchFacade.handler,false);document.addEventListener("touchend",touchFacade.handler,false);document.addEventListener("touchcancel",touchFacade.handler,false)};this.registerEmulator=function(a){if(!touchFacade.isEmulator(a)){throw"[Error] The argument is not a proper emulator object";return}touchFacade.unregisterEmulator();touchFacade.emulator=a;a.mount()};this.unregisterEmulator=function(){if(touchFacade.emulator==null)return;touchFacade.emulator.unmount();touchFacade.emulator=null};this.registerDispatcher=function(a){if(!touchFacade.isDispatcher(a)){throw"[Error] The given argument is not a proper dispatcher object";return}for(var b=0;b<a.eventMap.length;b++){var c=a.eventMap[b];for(var d=0;d<c.touchCount.length;d++){touchFacade.touchCountMap[c.touchCount[d]].push(c)}}};this.unregisterDispatcher=function(a){var b=touchFacade.handlers.indexOf(a);if(b!=-1){touchFacade.handlers.splice(b,1);for(var c=0;c<a.eventMap.length;c++){var d=a.eventMap[c];var e=d.touchCountMap.indexOf(d);while(e>=0){touchFacade.touchCountMap[e].splice(e,1);e=d.touchCountMap.indexOf(d)}}}else{throw"[Error] There is no such registered event dispatcher"}};this.isEmulator=function(a){if(typeof a.mount!=="function")return false;if(typeof a.unmount!=="function")return false;return true};this.isDispatcher=function(a){if(typeof a.eventMap==="undefined")return false;return true};this.handler=function(a){var b=a.targetTouches.length;var c=touchFacade.touchCountMap[b];if(typeof c=="undefined")return;for(var d=0;d<c.length;d++){if(c[d].eventType==a.type)c[d].action(a)}a.preventDefault()}};var mouseEmulator=new function(){this.pins=[];this.touches=[];this.selectedTouch=null;this.touchStart=null;this.touchId=0;this.emulation=false;this.mouseIsDown=false;this.mouseIsMoving=false;this.eventMap={mouseup:"touchend",mousedown:"touchstart",mousemove:"touchmove",mouseout:"touchcancel",keyup:"touchend"};var a=function(a,b){b.ctrlKey=a.ctrlKey;b.altKey=a.altKey;b.shiftKey=a.shiftKey;b.metaKey=a.metaKey};this.addTouch=function(a){var b=new Touch(mouseEmulator.touchId++,a.target,a.clientX,a.clientY);var c=document.createElement("span");c.setAttribute("style","position:fixed;z-index:10000;width:12px;height:12px;border-radius:12px;border:solid 1px rgba(0,0,0,.2);box-shadow:0 0 3px #000;background:#ca7;top: "+(a.clientY-5)+"px;left:"+(a.clientX-5)+"px;");document.body.appendChild(c);mouseEmulator.pins.push(c);mouseEmulator.touches.push(b);return b};this.removeTouchAt=function(a){mouseEmulator.touches.splice(a,1);var b=mouseEmulator.pins.splice(a,1)[0];document.body.removeChild(b)};this.clearTouches=function(){while(mouseEmulator.pins.length>0){var a=mouseEmulator.pins.pop();a.parentElement.removeChild(a)}while(mouseEmulator.touches.length>0){mouseEmulator.touches.pop()}};this.getTargetTouches=function(a){var b=[];for(var c=0;c<mouseEmulator.touches.length;c++){if(mouseEmulator.touches[c].target==a){b.push(mouseEmulator.touches[c])}}return b};this.enableMultitouch=function(a){if(a.keyCode!==16)return;mouseEmulator.emulation=true};this.disableMultitouch=function(b){if(typeof b!=="undefined"&&b.keyCode!==16)return;document.removeEventListener("mousemove",mouseEmulator.mousemoveHandler,false);mouseEmulator.emulation=false;mouseEmulator.mouseIsDown=false;mouseEmulator.mouseIsMoving=false;if(mouseEmulator.touches.length<=0)return;for(var c in mouseEmulator.touches){var d=mouseEmulator.touches[c];var e=d.target;d.target=null;mouseEmulator.removeTouchAt(c);var f=document.createEvent("Event");f.initEvent(mouseEmulator.eventMap[b.type],true,false,0);f.targetTouches=mouseEmulator.getTargetTouches(d.target);f.changedTouches=[d];f.touches=mouseEmulator.touches;a(b,f);e.dispatchEvent(f)}b.preventDefault();b.stopPropagation();mouseEmulator.clearTouches();mouseEmulator.touchStart=null};this.mousedownHandler=function(b){mouseEmulator.mouseIsDown=true;var c=false;if(mouseEmulator.emulation){for(var d in mouseEmulator.pins){if(Math.abs(mouseEmulator.touches[d].clientX-b.clientX)<=6&&Math.abs(mouseEmulator.touches[d].clientY-b.clientY)<=6){mouseEmulator.selectedTouch=d;mouseEmulator.touchStart=mouseEmulator.touches[d];mouseEmulator.pins[d].style.background="#ca7";c=true}}}document.addEventListener("mousemove",mouseEmulator.mousemoveHandler,false);document.addEventListener("mouseup",mouseEmulator.mouseupHandler,false);if(!c){if(!mouseEmulator.emulation)mouseEmulator.clearTouches();mouseEmulator.touchStart=mouseEmulator.addTouch(b);mouseEmulator.selectedTouch=mouseEmulator.touches.length-1}var e=document.createEvent("Event");e.initEvent(mouseEmulator.eventMap[b.type],true,true,0);e.touches=mouseEmulator.touches;e.targetTouches=mouseEmulator.getTargetTouches(mouseEmulator.touchStart.target);e.changedTouches=[mouseEmulator.touchStart];a(b,e);b.target.dispatchEvent(e);b.preventDefault();b.stopPropagation()};this.mouseupHandler=function(b){if(!mouseEmulator.mouseIsDown)return;document.removeEventListener("mousemove",mouseEmulator.mousemoveHandler,false);document.removeEventListener("mouseup",mouseEmulator.mouseupHandler,false);if(mouseEmulator.touches.length<=0)return;mouseEmulator.mouseIsDown=false;var c=mouseEmulator.touches[mouseEmulator.selectedTouch].target;var d=new Touch(mouseEmulator.touches[mouseEmulator.selectedTouch].identifier,null,b.clientX,b.clientY);var e=document.createEvent("Event");e.initEvent(mouseEmulator.eventMap[b.type],true,true,0);e.touches=mouseEmulator.touches;e.changedTouches=[d];a(b,e);if(mouseEmulator.emulation){if(!mouseEmulator.mouseIsMoving){mouseEmulator.pins[mouseEmulator.selectedTouch].style.background="#fff"}else{mouseEmulator.removeTouchAt(mouseEmulator.selectedTouch);e.targetTouches=mouseEmulator.getTargetTouches(c);if(c!=null)c.dispatchEvent(e);b.preventDefault();b.stopPropagation()}}else{mouseEmulator.clearTouches();e.targetTouches=mouseEmulator.getTargetTouches(c);if(c!=null)c.dispatchEvent(e);b.preventDefault();b.stopPropagation()}mouseEmulator.touchStart=null;mouseEmulator.mouseIsMoving=false};this.mouseoutHandler=function(b){if(!mouseEmulator.mouseIsDown)return;if(b.relatedTarget!=null)return;document.removeEventListener("mousemove",mouseEmulator.mousemoveHandler,false);mouseEmulator.mouseIsDown=false;mouseEmulator.mouseIsMoving=false;mouseEmulator.touchStart=null;var c=new Touch(mouseEmulator.touches[mouseEmulator.selectedTouch].identifier,b.target,b.clientX,b.clientY);mouseEmulator.touches[mouseEmulator.selectedTouch]=c;var d=document.createEvent("Event");d.initEvent(mouseEmulator.eventMap[b.type],true,true,0);d.changedTouches=[c];d.targetTouches=mouseEmulator.getTargetTouches(c.target);d.touches=mouseEmulator.touches;a(b,d);if(mouseEmulator.emulation){mouseEmulator.removeTouchAt(mouseEmulator.selectedTouch)}else{mouseEmulator.touches=new Array}b.target.dispatchEvent(d);b.preventDefault();b.stopPropagation()};this.mousemoveHandler=function(b){if(!mouseEmulator.mouseIsDown||mouseEmulator.touches.length==0)return;var c=mouseEmulator.touches[mouseEmulator.selectedTouch].target;var d=mouseEmulator.pins[mouseEmulator.selectedTouch];d.style.left=b.clientX-6+"px";d.style.top=b.clientY-6+"px";var e=mouseEmulator.touches[mouseEmulator.selectedTouch].identifier;var f=new Touch(e,c,b.clientX,b.clientY);mouseEmulator.touches[mouseEmulator.selectedTouch]=f;if(!mouseEmulator.mouseIsMoving){if(Math.abs(b.clientX-mouseEmulator.touchStart.clientX)>5||Math.abs(b.clientY-mouseEmulator.touchStart.clientY)>5){mouseEmulator.mouseIsMoving=true}}var g=document.createEvent("Event");g.initEvent(mouseEmulator.eventMap[b.type],true,true,0);g.touches=mouseEmulator.touches;g.targetTouches=mouseEmulator.getTargetTouches(f.target);g.changedTouches=[f];a(b,g);c.dispatchEvent(g);b.preventDefault();b.stopPropagation()};this.mount=function(){document.addEventListener("mouseout",mouseEmulator.mouseoutHandler,false);document.addEventListener("keydown",mouseEmulator.enableMultitouch,false);document.addEventListener("keyup",mouseEmulator.disableMultitouch,false);document.addEventListener("mousedown",mouseEmulator.mousedownHandler,false)};this.unmount=function(){mouseEmulator.disableMultitouch();document.removeEventListener("mousedown",mouseEmulator.mousedownHandler,false);document.removeEventListener("mousemove",mouseEmulator.mousemoveHandler,false);document.removeEventListener("mouseup",mouseEmulator.mouseupHandler,false);document.removeEventListener("mouseout",mouseEmulator.mouseoutHandler,false);document.removeEventListener("keydown",mouseEmulator.enableMultitouch,false);document.removeEventListener("keyup",mouseEmulator.disableMultitouch,false)}};var holdHandler=new function(){this.timerID=null;this.startTouch=null;this.startHandler=function(a){if(holdHandler.timerID==null){holdHandler.startTouch=a.changedTouches[0];holdHandler.timerID=setTimeout("holdHandler.dispatchEvent(holdHandler.startTouch)",1e3)}};this.dispatchEvent=function(a){if(a!==null&&holdHandler.timerID!==null){var b=document.createEvent("MouseEvents");b.initMouseEvent("tmHold",true,true,null,null,a.clientX,a.clientY,a.clientX,a.clientY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,0,null);b.identifier=a.identifier;a.target.dispatchEvent(b)}holdHandler.endHandler(a)};this.endHandler=function(a){if(holdHandler.startTouch!==null){clearTimeout(holdHandler.timerID);holdHandler.timerID=null;holdHandler.startTouch=null}};this.eventMap=new Array({eventType:"touchstart",action:this.startHandler,useCapture:true,touchCount:[1]},{eventType:"touchmove",action:this.endHandler,useCapture:true,touchCount:[1]},{eventType:"touchcancel",action:this.endHandler,useCapture:true,touchCount:[0,2]},{eventType:"touchend",action:this.endHandler,useCapture:true,touchCount:[0]})};var pinchHandler=new function(){this.target={};this.startTouches={};this.initEvent=function(a,b){var c=document.createEvent("Event");c.initEvent(a,true,true,0);c.ctrlKey=b.ctrlKey;c.altKey=b.altKey;c.shiftKey=b.shiftKey;c.metaKey=b.metaKey;if(typeof arguments[2]!=="undefined"){c.targetTouches=arguments[2]}else c.targetTouches=b.targetTouches;return c};this.touchstartHandler=function(a){var b=a.targetTouches[0].identifier;pinchHandler.target[b]=a.targetTouches[0].target;pinchHandler.startTouches[b]=a.targetTouches;var c=pinchHandler.initEvent("tmPinchStart",a);pinchHandler.target[b].dispatchEvent(c)};this.touchmoveHandler=function(a){var b={};for(i in a.changedTouches){var c=a.changedTouches[i];if(b.hasOwnProperty(c.identifier))continue;b[c.identifier]=[];for(var d in a.touches)if(a.touches[d].target===c.target)b[c.identifier].push(a.touches[d]);if(b[c.identifier].length!==2)continue;var e=null;for(var d in b[c.identifier])if(typeof pinchHandler.startTouches[b[c.identifier][d].identifier]!=="undefined"){e=b[c.identifier][d].identifier;continue}if(e==null)continue;var f=b[c.identifier];var g=pinchHandler.startTouches[e];var h=pinchHandler.initEvent("tmPinch",a,f);var j=g[0].clientX-g[1].clientX,k=g[0].clientY-g[1].clientY,l=f[0].clientX-f[1].clientX,m=f[0].clientY-f[1].clientY;a.rotation=(Math.atan(j/k)-Math.atan(l/m))*57.29578;if(k>=0&&m<0||k<0&&m>=0)a.rotation+=180;a.scale=Math.sqrt(l*l+m*m)/Math.sqrt(j*j+k*k);h.rotation=a.rotation;h.scale=a.scale;c.target.dispatchEvent(h)}delete b};this.touchendHandler=function(a){for(var b in a.changedTouches){var c=a.changedTouches[b];var d=pinchHandler.startTouches[c.identifier];if(typeof d=="undefined")continue;var e=pinchHandler.initEvent("tmPinchEnd",a);d[0].target.dispatchEvent(e);delete pinchHandler.target[c.identifier];delete pinchHandler.startTouches[c.identifier]}};this.eventMap=new Array({eventType:"touchstart",action:this.touchstartHandler,useCapture:false,touchCount:[2]},{eventType:"touchmove",action:this.touchmoveHandler,useCapture:false,touchCount:[2]},{eventType:"touchend",action:this.touchendHandler,useCapture:false,touchCount:[1]},{eventType:"touchcancel",action:this.touchendHandler,useCapture:false,touchCount:[2]})};var slideHandler=new function(){this.startTouches={};this.touchstartHandler=function(a){var b=a.targetTouches[0];slideHandler.startTouches[a.targetTouches[0].identifier]=new Touch(a.targetTouches[0].identifier,a.targetTouches[0].target,a.targetTouches[0].clientX,a.targetTouches[0].clientY);var c=document.createEvent("Event");c.initEvent("tmSlideStart",true,true,0);c.touch=b;c.identifier=b.identifier;slideHandler.startTouches[a.targetTouches[0].identifier].target.dispatchEvent(c)};this.touchmoveHandler=function(a){for(i in a.changedTouches){var b=a.changedTouches[i];var c=slideHandler.startTouches[b.identifier];if(typeof c=="undefined")return;var d=document.createEvent("Event");d.initEvent("tmSlide",true,true,0);d.startTouch=c;d.touch=b;d.dx=b.clientX-c.clientX;d.dy=b.clientY-c.clientY;d.distance=Math.sqrt(Math.pow(d.dx,2)+Math.pow(d.dy,2));d.identifier=c.identifier;c.target.dispatchEvent(d)}};this.touchendHandler=function(a){for(i in a.changedTouches){var b=a.changedTouches[i];var c=slideHandler.startTouches[b.identifier];if(typeof c=="undefined")continue;var d=document.createEvent("Event");d.initEvent("tmSlideEnd",true,true,0);d.startTouch=c;d.touch=b;d.dx=b.clientX-c.clientX;d.dy=b.clientY-c.clientY;d.distance=Math.sqrt(Math.pow(d.dx,2)+Math.pow(d.dy,2));d.identifier=c.identifier;c.target.dispatchEvent(d);delete slideHandler.startTouches[b.identifier]}};this.eventMap=new Array({eventType:"touchstart",action:this.touchstartHandler,useCapture:false,touchCount:[1]},{eventType:"touchmove",action:this.touchmoveHandler,useCapture:false,touchCount:[1]},{eventType:"touchend",action:this.touchendHandler,useCapture:false,touchCount:[0]},{eventType:"touchcancel",action:this.touchendHandler,useCapture:false,touchCount:[1]})};var tapHandler=new function(){this.timerID=null;this.startTouch=null;this.startHandler=function(a){if(tapHandler.timerID==null){tapHandler.startTouch=a.changedTouches[0];tapHandler.timerID=setTimeout("tapHandler.cancelHandler(null)",1e3)}};this.dispatchEvent=function(a){if(a!==null&&tapHandler.timerID!==null){var b=document.createEvent("MouseEvents");b.initMouseEvent("tmTap",true,true,null,null,a.clientX,a.clientY,a.clientX,a.clientY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,0,null);b.identifier=a.identifier;a.target.dispatchEvent(b)}tapHandler.cancelHandler(a)};this.endHandler=function(a){if(tapHandler.startTouch!==null){tapHandler.dispatchEvent(a)}};this.cancelHandler=function(a){clearTimeout(tapHandler.timerID);tapHandler.timerID=null;tapHandler.startTouch=null};this.eventMap=new Array({eventType:"touchstart",action:this.startHandler,useCapture:true,touchCount:[1]},{eventType:"touchmove",action:this.cancelHandler,useCapture:true,touchCount:[1]},{eventType:"touchcancel",action:this.cancelHandler,useCapture:true,touchCount:[1]},{eventType:"touchend",action:this.endHandler,useCapture:true,touchCount:[0]})}